# 存储相关

## 存储方案

DAS（直连存储）
　　是一种存储设备与服务器直接相连的架构。DAS为服务器提供块级的存储服务（不是文件系统级）。
DAS分为内部DAS和外部DAS两类：
内部DAS：
　　在内部DAS架构中，存储设备通过服务器机箱内部的并行或串行总线连接到服务器上。但是，物理的总线有距离限制，只能支持短距离的高速数据传输。此外，很多内部总线能连接的设备数目也有限，并且将存储设备放在服务器机箱内部，也会占用大量的空间 ，对服务器其它部件的维护造成困难。
外部DAS：
　　在外部DAS结构中，服务器与外部的存储设备直接相连。在大多数情况下，他们之间通过FC协议或者SCSI协议进行通信。与内部DAS相比，外部DAS克服了内部DAS对连接设备的距离和数量的限制。另外，外部DAS还可以提供存储设备集中化管理，更加方便。
NAS（网络附加存储）
　　是连接到一个局域网的基于IP的文件共享设备。NAS通过文件级的数据访问和共享提供存储资源，使客户能够以最小的存储管理开销快速直接共享文件；采用NAS可以不用建立多个文件服务器，是首选的文件共享存储解决方案； NAS还有助于消除用户访问通用服务器时的瓶颈；NAS使用网络和文件共享协议进行归档和存储，这些协议包括进行数据传输的TCP/IP和提供远程文件服务的CIFS（通用网络文件系统）、NFS（网络文件系统）。注意：采用NAS共享的时候，UNIX通常使用用NFS，Windows使用CIFS。
拓展：
　　随着网络技术的发展，NAS扩展到用于满足企业访问数据高性能和高可靠性的需求。 NAS设备是专用的、高性能的、高速的、单一用途的文件服务和存储系统。
SAN（存储区域网络）
　　是一个用在服务器和存储资源之间的、专用的、高性能的网络体系。它为了实现大量原始数据的传输而进行了专门的优化。因此，可以把FC SAN看成是对SCSI协议在长距离应用上的扩展（原先的SCSI协议最大的传输距离是6米）。FC SAN使用的典型协议组是SCSI和Fiber Channel 。 Fiber Channel特别适合这项应用，原因在于一方面它可以传输大块数据，另一方面它能够实现远距离传输。
实现IP SAN的典型协议是iSCSI，它定义了SCSI指令集在IP网络中传输的封装方式。
拓展：
　　SAN和NAS最大的区别就是NAS可以给计算节点提供文件系统 对于结算节点来说，拿到的直接就是可以共享的文件夹（共享目录）一样的感觉，但是SAN方案给计算节点提供的是一个裸盘，是无法直接进行使用的，需要对其进行格式化分区，部署文件系统等等操作以后才可以使用。 

FusionStorage采用的就是DHT算法，具有以下特点：
　　均衡性：数据能够尽可能分布到所有的节点中，这样可以使得所有节点负载均衡。
　　单调性：当有新节点加入系统中，系统会重新做数据分配，数据迁移仅涉及新增节点，现有节点上的数据不需要做很大调整。
ETL
　　是英文Extract-Transform-Load的缩写，用来描述将数据从来源端经过抽取（extract）、转换（transform）、加载（load）至目的端的过程。


Zonging

1.一个设备可以在多个zong

## 结构化数据与非结构化数据

　　结构化数据也称作行数据，是由二维表结构来逻辑表达和实现的数据，严格地遵循数据格式与长度规范，主要通过关系型数据库进行存储和管理。
　　与结构化数据相对的是不适于由数据库二维表来表现的非结构化数据，包括所有格式的办公文档、XML、HTML、各类报表、图片和音频、视频信息等。支持非结构化数据的数据库采用多值字段、了字段和变长字段机制进行数据项的创建和管理，广泛应用于全文检索和各种多媒体信息处理领域。
半结构化数据　
　　比如存储员工的简历。不像员工基本信息那样一致每个员工的简历大不相同。有的员工的简历很简单，比如只包括教育情况；有的员工的简历却很复杂，比如包括工作情况、婚姻情况、出入境情况、户口迁移情况、党籍情况、技术技能等等。还有可能有一些我们没有预料的信息。
　　半结构化数据中结构模式附着或相融与数据本身，数据自身就描述了其相应结构模式。具体来说，半结构化数据具有下述特征：
（1）数据结构自描述性。结构与数据相交融，在研究和应用中不需要区分“元数据”和“一般数据”（两者合二为一）。
（2）数据结构描述的复杂性。结构难以纳入现有的各种描述框架，实际应用中不易进行清晰的理解与把握。
（3）数据结构描述的动态性。数据变化通常会导致结构模式变化，整体上具有动态得结构模式。

## SCSI协议

https://www.jianshu.com/p/c890e3ad9c07
虽然SCSI控制器可以连接多个存储设备，形成自己的网络，但是它只能与直接相连的存储设备进行通信，只能在在局域网内部使用，不能再以太网上共享。


总线是计算机与存储系统间通讯的主要通道，是源设备到目标设备的传输路径
SCSI接口是一种用于计算机与周边设备通讯的接口。如上图，SCSI总线上数据操作和管理都是由SCSI的控制器进行控制，SCSI控制器可以看作是一块小型CPU，它有自己的命令集和缓存。上图的SCSI结构可以对计算机中连接到SCSI总线上的多个设备动态分工操作，灵活分配资源
 SCSI通讯过程
1、检测状态：总线在开始通讯之前，总线必须处于空闲状态。发起连接的设备通讯之前首先会发起一个测试信号来确认总线是否空闲。

2、寻址：通过发送方地址和接收方地址来确认通讯源和目标。

3、协商：正式通讯前需要双方协商数据包大小、发送速度和一些其他参数

4、连接：正式建立连接，通讯发包

5、断开连接：数据传输完成，释放总线

断开重连技术

只有在第一次建立连接才经历协商步骤，之后相同的两个设备通讯不在经历协商步骤

标签指令队列技术

原有通讯方式是发送方和接收方只要数据没通讯完毕就一直占用总线资源，别的人进不来。利用上述技术，通讯过程有所变化。

发送方建立连接之后，一次发送多个数据包，目标接收器只要收到包就立即释放总线资源。然后自己慢慢处理这些收到的包，处理完之后，继续与发送方通讯（发送方再发N个包，接收到接到之后再释放总线自己慢慢处理.......循环）。这种方式通讯比较高效率。

SCSI数据传输方式
异步传输
两组数据传输之间没有固定的时间间隔。
同步传输
数据包会按照定时器设定好的时间间隔进行传输

SCSI ID
用于标识总线上的设备，是唯一的。同时也代表了各个设备的优先级。当一个设备需要发送数据的时候，首先会探测总线是否在忙。如果在忙（有其他设备发送数据中）就需要等待一定的时间再次尝试发送。这个等待时间的长短就是有SCSI ID决定的。优先级越高，等待时间越短，反之等待时间越长。举个例子：
设备1等待时间为：2s
设备2等待时间为：10s
设备1每隔2S就尝试发送数据，设备2则每隔10s尝试发送数据。很明显设备1（优先级高的设备）获得发送数据的概率高！
注意SCSI ID虽然是总线上设备的唯一标识，但是仅仅依靠SCSI ID并不能寻址。


SCSI协议寻址
需要3个元素来寻址
总线号（BUS ID）：用于区分每一条总线，多个SCSI控制器需要用总线号来确定是哪一个控制器。
设备号（SCSI ID）：用于识别某一总线上的每一个存储设备。
逻辑单元号（LUN ID）：识别某存储设备上的每一个子设备。子设备包括虚拟磁盘、磁带驱动器等。利用逻辑单元号可以对存储设备中的每一个子设备进行寻址。

## iSCSI
iSCSI协议是一种新的存储技术，它是将SCSI接口与以太网（Ethernet）技术结合起来工作的，简单的说iSCSI协议是将用户的请求转换成SCSI规则编码，然后再将这些数据封装在IP包中以便在以太网中进行传输的协议。
2.1 iSCSI协议的功能
iSCSI:internet Small Computer System  Interface的缩写，即Internet小型计算机接口。iSCSI技术是一种由IBM公司研究开发的，是一个供硬件设备使用的可以在IP协议的上层运行的SCSI指令集，这种指令集合可以实现在IP网络上运行 SCSI协议，使其能够在诸如高速千兆以太网上进行路由选择。它是基于TCP/IP协议的，用来建立和管理IP存储设备、主机和客户机之间的相互连接，并创建SAN。这样使得SAN利用SCSI协议应用在高速数据传输网络成为可能。这种传输是以块级别的方式在各个存储设备上进行的。

2.2 iSCSI的结构
由于SCSI协议是一个C/S架构，因此iSCSI协议也是一个C/S结构，其中client是initiator,server端为target。iSCSI协议的主要功能是利用TCP/IP网络，在主机系统（可称为initiator）和目标存储设备（称为target）之间进行大量的数据封装和可靠传输过程。此外，iSCSI协议还将SCSI协议封装在IP网络上，并且运行在TCP上。
2.3 iSCSI协议的工作原理
当iSCSI主机发起数据读写操作后，操作系统会生成一个SCSI指令集，然后该SCSI指令集在iSCSI initiator端被封装成iSCSI消息包，并通过TCP/IP网络传输到存储区域，当存储区域的iSCSI target收到iSCSI消息包时会将其解开，读取其中的SCSI指令，然后再将其SCSI指令传送给SCSI设备执行其指令。当SCSI指令被执行后，返回的数据经过SCSI设备传送给iSCSI target时被封装为iSCSI的响应PDU，然后再通过TCP/IP网络传输给iSCSI initiator端，iSCSI initiator解开其iSCSI PDU包，读取其中的SCSI响应内容，并将其提交给操作系统进行处理，然后操作系统在将其处理后的内容返回给应用程序。
2.4 iSCSI的优点
iSCSI最大的优点就是节约成本，利用iSCSI协议构建一个存储网络，除了需要存储设备，交换机、线缆还有以太网接口以外，基本就不需要其他的设备了，只需要在现有的网络上安装iSCSI就可以实现构建一个比较大的存储网络了。

2.5 iSCSI基本概念
iSCSI客户端 (iSCSI Initiator)
iSCSI客户端为iSCSI initiator，这是I/O操作的发起者。在RedHat Linux系统中可以通过软件来模拟，需要安装iSCSI设备驱动。如iscsi-initiator-utils.rpm
iSCSI  initiator具有的特性：
a) 既然是I/O操作的发起者，需要通过发现过程请求远端快设备。
b) 它可以与target进行持久连接
c) Linux中可以通过软件方式来实现

iSCSI服务器端 (iSCSI Target)
iSCSI服务器端为iSCSI target，这是I/O操作的执行者。在RedHat Enterprise Linux中可以使用scsi-target-utils软件包来模拟实现。
iSCSI target端具有的特性：
a) 需要导出一个或多个块设备供启动者（initiator）使用
b) 可以通过硬件和软件的方式来实现

iSCSI target设备名称
iSCSI target名称必须是全球唯一的，其格式为：

iqn.<yyyy-mm>.<tld.domain.some.host>[:<identifier>]

# iqn：iSCSI target名称必须是以iqn开头的
# yyyy-mm：表示的是时间
# tld.domain.some.host：这个表示的是一个反过来写的域名
# identifier：这个可以是任意字符串
# 如：iqn.2015-03.com.xsl.www:storge.disk1
逻辑单元号LUN
LUN ID由iSCSI目标设备（Target）分配。iSCSI 启动端（Initiator）设备当前支持在每个目标设备（Target）中导出最多256个LUN。即最大支持16个target。
对于LUN，比较通俗的理解就是磁盘分区、LVM卷组、RAID等等。

Target 即“储存设备”（Storage Device），也就是存放数据的硬盘（以硬盘阵列居多）。在使用iSCSI时，会在 iSCSI 储存设备上去建立 LUN（Logical Unit Number）来提供给具备 iSCSI Initiator 功能的主机来存取 数据的。LUN 好比是个“逻辑单位磁碟”，物理上通常是由数个实体磁碟（ RAID 或 LVM 技术的技术实现）所组成。

2.6 iSCSI的发现机制
iSCSI发起端为了和iSCSI目标端建立iSCSI会话，initiator需要知道target的 IP地址，TCP端口号和名字 三个信息。iSCSI发现的目的是为了让iSCSI发起端获取一条到iSCSI目标端的通路。iSCSI有三种发现机制：

a. 静态配置
在iSCSI发起端已经知道iSCSI目标端的IP地址TCP端口号和名字信息时，iSCSI发起端不需要执行发现。iSCSI发起端直接通过IP地址和TCP端口来建立TCP连接，使用iSCSI目标端的名字来建立iSCSI会话。这种发现机制比较适合比较小的iSCSI体系结构

b. SendTarget发现
在iSCSI发起端知道iSCSI目标端的IP地址和TCP端口的情况下，iSCSI使用IP地址和TCP端口号建立TCP连接后建立发现对话。iSCSI发起端发送SendTarget命令查询网络中的存在的iSCSI信息。这种方法主要用于网关设备，iSCSI发起端被静态配置连接到指定的iSCSI设备。iSCSI发起端和iSCSI网关设备建立对话并发送SendTarget请求给iSCSI网关设备。iSCSI网关设备返回一系列和它相连的ISCSI目标端的信息。iSCSI发起端选择一个目标端来建立对话。

c. 零配置发现
这种机制用于iSCSI发送设备完全不知道iSCSI目标端的信息的情况下。iSCSI发起端利用现有的IP网络协议SLP（Service Location Protocol for Discovery,服务定位协议）。iSCSI目标端使用SLP来注册，iSCSI发起端可以通过查询SLP代理来获得注册的iSCSI目标端的信息。当iSCSI目标端加入到网络中的时候，拓扑结构也随之改变。虽然这种方法增加了实现的复杂性，但它不需要重新配置发起端即可找到新的目标端。

## SmartMigration
源lun 迁移到目标lun ，不会中断业务





## SmartThin


## Hypersnap

# 备份
持续备份：


不会中断业务

读数据：
1.接到lun读请求
2.查询lun 与 pool 映射表
3.查询已分配空间

## SmartTier
数据迁移：提供数据迁移时段

迁移粒度：迁移粒度越越快
## SmartQos
流量控制 基于令牌分配技术
一个扇区对应一个令牌
## SmartDedupeu
1.先分块
2.计算指纹信息
3.相似度重删机会表


在线重删原理
后处理相似重删


## 常用存储高级技术【精简配置、存储分层、缓存分区、快照、文件系统配额管理】
### 精简配置(smartThin)技术
https://blog.csdn.net/cuichongxin/article/details/113921396


## 数据与信息

​        数据和信息是相互联系的，数据是反映客观事务属性的记录，是信息的具体表现形式。而数据经过处理和加工以后就变成信息，而信息是需要经过数字化处理转变成数据记才能进行存储和传输。
信息论观点：
​        数据=信息+数据冗余
简而言之：
​        信息就是数据中包含的有用的东西。
​        从数据中经过用户指定的规则或者特定需求场景下提炼出来的信息能够为企业带来以下好处：

​		市场以及客户行为的信息
​		更高效的运营业务
​		帮助确定风险因素 

## RAID 

### 基本原理

RAID （ Redundant Array of Independent Disks ）即独立磁盘冗余阵列，通常简称为磁盘阵列。简单地说， RAID 是由多个独立的高性能磁盘驱动器组成的磁盘子系统，从而提供比单个磁盘更高的存储性能和数据冗余的技术。 RAID 是一类多磁盘管理技术，其向主机环境提供了成本适中、数据可靠性高的高性能存储。 SNIA 对 RAID 的定义是 [2] ：一种磁盘阵列，部分物理存储空间用来记录保存在剩余空间上的用户数据的冗余信息。当其中某一个磁盘或访问路径发生故障时，冗余信息可用来重建用户数据。磁盘条带化虽然与 RAID 定义不符，通常还是称为 RAID （即 RAID0 ）。

RAID 的初衷是为大型服务器提供高端的存储功能和冗余的数据安全。在整个系统中， RAID 被看作是由两个或更多磁盘组成的存储空间，通过并发地在多个磁盘上读写数据来提高存储系统的 I/O 性能。大多数 RAID 等级具有完备的数据校验、纠正措施，从而提高系统的容错性，甚至镜像方式，大大增强系统的可靠性， Redundant 也由此而来



RAID

https://cloud.tencent.com/developer/article/2046751



RDMA

https://zhuanlan.zhihu.com/p/506835089





# CIFS和NFS的区别

（1）CIFS面向网络连接的共享协议，对网络传输的可靠性要求高，常使用TCP/IP；NFS是独立于传输的，可使用TCP或UDP；

（2）NFS缺点之一，是要求client必须安装专用软件；而CIFS集成在OS 内部，无需额外添加软件；

（3）NFS属无状态协议，而CIFS属有状态协议；NFS受故障影响小，可以自恢复交互过程，CIFS不行；从传输效率上看，CIFS优于NFS，没用太多冗余信息传送；

（4）两协议都需要文件格式转换，NFS保留了unix的文件格式特性，如所有人、组等等；CIFS则完全按照win的风格来作。



 





# 存储系统架构演变

https://sunjian.blog.csdn.net/article/details/125111808



# SmartThin

https://blog.csdn.net/sj349781478/article/details/125116173



## RTO和RPO



# 完全备份、增量备份和差异备份的区别在哪里？

![](images\backup.png)



# 热备、冷备、双活

**两地 = 本地 + 异地**

**三中心 = 本地中心 + 本地容灾中心 +异地备份中心**

主备数据中心之间一般有热备、冷备、双活三种备份方式。

**热备**的情况下，只有主数据中心承担用户的业务，在**不停机情况下**对主数据中心进行备份。

**冷备**的情况下，也是只有主数据中心承担业务，在**停机情况下**对主数据中心进行备份。

**双活**是觉得备用数据中心只做备份太浪费了，所以让主备两个数据中心都同时承担用户的业务，此时，主备两个数据中心互为备份，并且进行实时备份。一般来说，主数据中心的负载可能会多一些，比如分担60~70%的业务，备数据中心只分担40%~30%的业务 。



# [共享存储、C/S和B/S架构、存储的分类和区别（SAN、NAS、DAS）、存储共享的过程](https://www.cnblogs.com/yunjisuanchengzhanglu/p/16040054.html)



DAS（Direct Attached Storage—直接连接存储），是指将存储设备通过SCSI接口或[光纤通道](http://baike.baidu.com/view/15247.htm)直接连接到服务器上

https://www.cnblogs.com/yunjisuanchengzhanglu/p/16040054.html
## 容灾和备份的区别
  - 容灾的对象一般是大批量的数据，例如主用数据中心中的所有的生产数据，核心业务数据等，需要在主用数据中心或者主用业务链路出现故障时进行大范围大批量的数据迁移，以保证业务数据的不丢失和整体业务的连续性
  - 备份相对于容灾来说需要备份的数据是比较小规模的，具有明确的针对性的数据，比如针对某一个可靠性要求较高的业务数据或者某一个租户的数据等。
- 容灾等级
https://blog.csdn.net/f1092522699/article/details/112861274 
## 存储方案


## 磁盘数据写入方式：

-  buffer io
   -  使用Buffer I/O的时候才在内存与磁盘中间加了一层page cache。
   数据在写入的时候，数据会被先写入page cache。如果用户采用的时同步写(synchronous write)，则数据会立即从page cache写回到磁盘中；如果使用的时延迟写(deferred writes)，那么应用程序就完全不需要等到数据全部被写回到磁盘，数据只要被写到页缓存中就可以了，操作系统会定期将页缓存中的数据刷回到磁盘。而标准IO库中的一组带缓存的io函数（fopen，fread，fwrite等函数），每次调用则不直接调用内核函数，而是在用户态中创建缓存，等到一定量时才和内核交互，其中调用fflush则可以将用户态的数据刷到内核态的内存页中。
   - 优缺点
     - 优点：减少了磁盘的交互次数，由内核控制读取写入时机。
     缺点：数据需要在用户态和内核态进行多次交互，增加了内核开销；其次若机器突然宕机，则数据可能会丢失
-  mmap
   -  MMap(Memort-map) IO 能将一个磁盘文件映射到存储空间中（用户态）的一个缓存区上，于是，当从缓存区中读取数据时，就相当于读文件中的相应字节。于此类似，将数据存入缓存区时，相应字节就自动写入文件。这样就可以不使用read和write的情况下执行I/O，因此减少了内核态到用户态，用户态到内核态的多次转换。可以调用msync将mmap的page cache刷入磁盘中
   -  优缺点
   优点： 减少了内核态到用户态交互的开销，减少了磁盘的交互次数。
   缺点：机器宕机，还没写写入磁盘的数据会丢失。
-  direct io
   -  Linux允许应用程序在执行磁盘IO时绕过缓冲区高速缓存，从用户空间直接将数据传递到文件或磁盘设备，称为直接IO（direct IO）或者裸IO（raw IO）
   -  优点：如果要传输的数据量很大，降低数据在page cache中的拷贝带来的开销，提高性能。
   缺点：Direct I/O的开销大，因为没有page cache的使用，因此内核中很多对page cache的优化也无法使用（例如：按顺序预读取，在成簇磁盘块上执行IO，允许访问同一文件的多个进程共享高速缓存的缓冲区等）



## HyperReplication  远程复制

https://blog.csdn.net/m0_49864110/article/details/124126379











## RAID


## 硬盘类型：
### SSD
### SAS
https://blog.csdn.net/sinat_37817094/article/details/120935299

点对点架构 性能高可达300M/s 600MB/s 或者更高
SAS特点
因为采用串行通信方式, 可以提供更高的吞吐量, 并为将来更高的性能成为可能

4个窄端口可以绑定成一个宽端口, 提供更高的吞吐量

2.SAS采用全双工通信模式

SAS采用全双工（双向）通信模式，而不是单向通信。传统的并行SCSI只可以在一个方向上进行通信，当设备接收到并行SCSI的一个数据包后，如果该设备要响应该数据包，就需要在上一个链路断开后，再重新建立一个新的SCSI通信链路。而是用SAS，则可以进行双向通信。每个SAS电缆有4根电缆， 2根输入2根输出。 SAS可以同时进行数据的读写，全双工的数据操作提高数据的吞吐效率。


### NL-SAS

### IB网络

IB网络因其低延迟、高带宽的网络特性被用于很多高性能计算（High Performance Computing，HPC）项目，IB网络采用了100G Mellanox IB网卡，通过专用IB交换机和控制器软件UFM实现网络通信和管理。IB网络通过Partition Key实现网络隔离，不同租户的IB网络可通过不同的Partition Key来隔离，类似于以太网的VLAN。在BMS场景，IB网络支持RDMA和IPoIB通信方式。

## RAID2.0+

### 传统RAID
基于硬盘做RAID组（确认RAID级别）   直接由硬盘构成LUN
        热备使用专门的热备盘
        重构时     多对一     无论磁盘空间是否占满，都会重构整个磁盘


RAID1.5      先做RAID，再进行LUN化
重构时     多对一      无论磁盘空间是否占满，都会重构整个磁盘
RAID2.0     先做逻辑块组成LUN，再将LUN做RAID
  块虚拟化   将硬盘切为多个逻辑块，再将逻辑块组成LUN（每个逻辑块都来自不同的硬盘）
         基于LUN做RAID组（确认RAID级别）   即每个LUN就是一个RAID组
         重构时      多对多       重构时只重构硬盘使用的部分
硬盘域 
        此处是硬盘域（支持不同类型硬盘 SAS、NL-SAS、SSD等），不是硬盘组（只支持同类型硬盘）
        硬盘域分为高性能层（SSD）、性能层（SAS）、容量层（NL-SAS/SATA）。

CK
        逻辑块，每个磁盘都有一个CK做热备块，全部的热备块组成热备盘
        CK的大小默认一般是64M

CKG
        逻辑块组（RAID组，确认RAID级别），由CK组成（每个CK都来自不同的硬盘）

Extent/Grain
        由Extent组成的LUN不支持精简置备

                -----精简置备（即用多少给多少，类似VM分给虚拟机的内存一样）
    
        Extent一般组成单位是4MB
        将Extent切为密度更小的Grain组成LUN，此LUN更为精简LUN，支持精简置备（SmartThin）

## RDMA

在分布式存储网络中，我们使用的协议有RoCE、Infiniband（IB）和TCP/IP。其中RoCE和IB属于RDMA(RemoteDirect Memory Access)技术

### RDMA和TCP/IP

面对高性能计算、大数据分析等IO高并发、低时延应用，现有TCP/IP软硬件架构不能满足应用的需求，这主要体现在传统的TCP/IP网络通信是通过内核发送消息，这种通信方式存在很高的数据移动和数据复制的开销。RDMA(RemoteDirect Memory Access)技术全称远程直接内存访问，就是为了解决网络传输中服务器端数据处理的延迟而产生的 ，RDMA技术能直接通过网络接口访问内存数据，无需操作系统内核的介入。这允许高吞吐、低延迟的网络通信，尤其适合在大规模并行计算机集群中使用

![](images\edma.png)

### RDMA的种类	

目前有三种RDMA网络，分别是Infiniband、RoCE(RDMA over Converged Ethernet)、iWARP。

### Infiniband

Infiniband是一种专为RDMA设计的网络，从硬件级别保证可靠传输 ，技术先进，但是成本高昂。

 而RoCE 和 iWARP都是基于以太网的RDMA技术，这使高速、超低延时、极低CPU使用率的RDMA技术得以部署在目前使用最广泛的以太网上。是一种专为RDMA设计的网络，从硬件级别保证可靠传输 ，技术先进，但是成本高昂。 而RoCE 和 iWARP都是基于以太网的RDMA技术，这使高速、超低延时、极低CPU使用率的RDMA技术得以部署在目前使用最广泛的以太网上。

### RoCE、iWARP、IB和TCP

https://blog.csdn.net/u012158332/article/details/125334200






# 存储快照
全球网络存储工业协会SNIA（StorageNetworking Industry Association）对快照（Snapshot）的定义是：关于指定数据集合的一个完全可用拷贝，该拷贝包括相应数据在某个时间点（拷贝开始的时间点）的映像。快照可以是其所表示的数据的一个副本，也可以是数据的一个复制品。

快照的作用主要是能够进行在线数据备份与恢复。当存储设备发生应用故障或者文件损坏时可以进行快速的数据恢复，将数据恢复某个可用的时间点的状态。快照的另一个作用是为存储用户提供了另外一个数据访问通道，当原数据进行在线应用处理时，用户可以访问快照数据，还可以利用快照进行测试等工作。所有存储系统，不论高中低端，只要应用于在线系统，那么快照就成为一个不可或缺的功能。 

快照的两种实现方式：
（1）一种为COW，全称为Copy-On-Write。也就是在原始磁盘写数据的时候会将原始数据拷贝到新的地方。当然，并不是每次写数据都会拷贝，而是第一次写数据的时候才会拷贝。这里有一个位图记录着已经拷贝过的数据，如果已经拷贝过，则下次再写数据的时候将不会再拷贝了。

（2）另一种为ROW，全称为Redirect-On-Write，也就是写时重定向。这种实现方式的基本原理是当原始磁盘写数据的时候并不在原始位置写入数据，而是分配一个新的位置

当前实现快照有主要有两种技术，一种是第一次写时复制(Copy OnFirst Write,COFW)，有时简称为写时复制（CopyOn Write,COW）。即在数据第一次写入到某个存储位置时，首先将原有的内容读取出来，写到另一位置处（为快照保留的存储空间，此文中我们称为快照空间），然后再将数据写入到存储设备中。而下次针对这一位置的写操作将不再执行写时复制操作。这种技术常在计算机相关的技术中经常初使用，其基本原理大同小异，只是面向的对象不同，适用的场合不一样。从COW 的执行过程我们可以知道，这种实现方式在第一次写入某个存储位置时需要完成一个读操作（读原位置的数据），两个写操作（写原位置与写快照空间），如果写入频繁，那么这种方式将非常消耗IO时间。因此可推断，如果预计某个卷上的I/O多数以读操作为主，写操作较少，这种方式的快照实现技术是一个较理想的选择，因为快照的完成需要较少的时间。除此之外，如果一个应用易出现写入热点，即只针对某个有限范围内的数据进行写操作，那么COW的快照实现方式也是较理想的选择。因为其数据更改都局限在一个范围内，对同一份数据的多次写操作只会出现一次写时复制操作。

# InfiniBand-network架构

https://blog.csdn.net/sz_woshishazi/article/details/127059318

IB标准的优势
IB（InfiniBand）协议是用于高性能计算的网络通讯标准，其主要优势是：

支持大量协议：包括通过IB光纤的非IB协议的隧道包，例如IPv6、Ethertype包；
高带宽，吞吐量可实现2.5Gb/s，10Gb/s，30Gb/s；
低延时，应用程序时延 <3us；
高可扩展性的拓扑结构；
非特权应用发送接收信息时，内核不用进行特权模式的切换；
每个信息都由CA（通道适配器）的硬件DMA直接传输，而不用处理器的参与，也就是RDMA；
大部分协议都可以在芯片上实现，减少软件和处理器的负荷。 
## 分布式存储中常用的网络协议
IB：常用于DPC场景中的存储前端网络。
RoCE：常用于存储后端网络。
TCP/IP：常用于业务网络。

SATA硬盘
       SATA的全称是Serial Advanced Technology Attachment（串行高级技术附件，一种基于行业标准的串行硬件驱动器接口,也即串行ATA），是由Intel、IBM、Dell、APT、Maxtor和Seagate公司共同提出的硬盘接口规范。 
传统的并行ATA（PATA）技术曾经在低端的存储应用中有过光辉的岁月，但由于自身的技术局限性，逐步被串行总线接口协议（Serial ATA，SATA）所替代。SATA以它串行的数据发送方式得名。在数据传输的过程中，数据线和信号线独立使用，并且传输的时钟频率保持独立，因此同以往的PATA相比，SATA的传输速率可以达到并行的30倍。可以说：SATA技术并不是简单意义上的PATA技术的改进，而是一种全新的总线架构。 
       从总线结构上，SATA 使用单个路径来传输数据序列或者按照bit来传输，第二条路径返回响应。控制信息用预先定义的位来传输，并且分散在数据中间，以打包的格式用开/关信号脉冲发送，这样就不需要另外的传输线。SATA带宽为16-bit。并行Ultra ATA总线每个时钟频率传输16bit数据，而SATA仅传输1bit，但是串行总线可以更高传输速度来弥补串行传输的损失。SATA将会引入1500Mbits/sec带宽或者1.5Gbits/sec带宽。由于数据用8b/10b编码，有效的最大传输峰值是150Mbytes/sec。 
        目前能够见到的有SATA-1和SATA-2两种标准，对应的传输速度分别是150MB/s和300MB/s。从速度这一点上，SATA已经远远把PATA硬盘甩到了后面。其次，从数据传输角度上，SATA比PATA抗干扰能力更强。此外，串口的数据线由于只采用了四针结构，因此相比较起并口安装起来更加便捷，更有利于缩减机箱内的线缆，有利散热。 
        尽管SATA在诸多性能上远远优越于PATA，甚至在某些单线程任务的测试中，表现出了不输于SCSI的性能，然而它的机械底盘仍然为低端应用设计的，在面对多线程的传输任务时，相比SCSI硬盘，仍然显得力不从心。
SAS硬盘
       SAS(Serial Attached SCSI)即串行连接SCSI，是新一代的SCSI技术，和现在流行的Serial ATA(SATA)硬盘相同，都是采用串行技术以获得更高的传输速度，并通过缩短连结线改善内部空间等。SAS是并行SCSI接口之后开发出的全新接口。此接口的设计是为了改善存储系统的效能、可用性和扩充性，并且提供与SATA硬盘的兼容性。 
SAS技术还有简化内部连接设计的优势，存储设备厂商目前投入相当多的成本以支持包括光纤通道阵列、SATA阵列等不同的存储设备，而SAS连接技术将可以通过共用组件降低设计成本。 
        为保护用户投资，SAS的接口技术可以向下兼容SATA。SAS系统的背板(Backplane)既可以连接具有双端口、高性能的SAS驱动器，也可以连接高容量、低成本的SATA驱动器。过去由于SCSI、ATA分别占领不同的市场段，且设备间共享带宽，在接口、驱动、线缆等方面都互不兼容，造成用户资源的分散和孤立，增加了总体拥有成本。而现在，用户即使使用不同类型的硬盘，也不需要再重新投资，对于企业用户投资保护来说，实在意义非常。但需要注意的是，SATA系统并不兼容SAS，所以SAS驱动器不能连接到SATA背板上。 
        SAS 使用的扩展器可以让一个或多个 SAS 主控制器连接较多的驱动器。每个扩展器可以最多连接 128 个物理连接，其中包括其它主控连接，其它 SAS 扩展器或硬盘驱动器。这种高度可扩展的连接机制实现了企业级的海量存储空间需求，同时可以方便地支持多点集群，用于自动故障恢复功能或负载平衡。目前，SAS接口速率为3Gbps，其SAS扩展器多为12端口。不久，将会有6Gbps甚至12Gbps的高速接口出现，并且会有28或36端口的SAS扩展器出现以适应不同的应用需求。其实际使用性能足于光纤媲美。
        由于SAS由SCSI发展而来，在主机端会有众多的厂商兼容。SAS采用了点到点的连接方式，每个SAS端口提供3Gb带宽，传输能力与4Gb光纤相差无几，这种传输方式不仅提高了高可靠性和容错能力，同时也增加了系统的整体性能。在硬盘端，SAS协议的交换域能够提供16384个节点，而光纤环路最多提供126个节点。而兼容SATA硬盘所体现的扩展性是SAS的另一个显著优点，针对不同的业务应用范围，在硬盘端用户可灵活选择不同的存储介质，按需降低了用户成本。 
        在SAS接口享有种种得天独厚的优势的同时，SAS产品的成本从芯片级开始，都远远低于FC，而正是因为SAS突出的性价比优势，使SAS在硬盘接口领域，给光纤存储带来极大的威胁。
FC硬盘 
        FC硬盘是指采用FC-AL( Fiber Channel  Arbitrated  Loop，光纤通道仲裁环) 接口模式的磁盘。FC-AL使光纤通道能够直接作为硬盘连接接口，为高吞吐量性能密集型系统的设计者开辟了一条提高I/O性能水平的途径。目前高端存储产品使用的都是FC接口的硬盘。 
        FC硬盘名称由于通过光学物理通道进行工作，因此起名为光纤硬盘，现在也支持铜线物理通道。就像是IEEE-1394, Fibre Channel 实际上定义为SCSI-3标准一类，属于SCSI的同胞兄弟。作为串行接口FC-AL峰值可以达到2Gbits/s甚至是4Gbits/s。而且通过光学连接设备最大传输距离可以达到10KM。通过FC-loop可以连接127个设备，也就是为什么基于FC硬盘的存储设备通常可以连接几百颗甚至千颗硬盘提供大容量存储空间。 
        关于光纤硬盘以其的优越的性能、稳定的传输，在企业存储高端应用中担当重要角色。业界普遍关注的焦点在于光纤接口的带宽。最早普及使用的光纤接口带宽为1Gb，随后2Gb带宽光纤产品统治市场已经长达三年时间。现在的带宽标准是4Gb，目前普遍厂商都已经采用4Gb相关产品。8Gb光纤产品也将在不久的将来取代4Gb光纤成为市场主流。 
        4Gb是以2Gb为基础延伸的传输协议，可以向下兼容1Gb和2Gb，所使用的光纤线材、连接端口也都相同，意味着使用者在导入4Gb设备时，不需为了兼容性问题更换旧有的设备，不但可以保护既有的投资，也可以采取渐进式升级的方式，逐步淘汰旧有的2Gb设备。

SATA, SAS,FC三种硬盘的比较 
        对于用户来说：单纯比较硬盘并不一定是越贵的越好，关键是看是否适合自己的应用。另外单纯硬盘的硬盘接口协议也不是衡量一个存储系统性能指标的唯一要素，除了硬盘性能指标以外，存储系统的硬件设计，前端主机接口等性能指标也同样对存储系统的整体性能影响巨大。
如果需要应用于I/O负载较轻的应用比如文件共享、FTP、音频存储、数据备份等可以考虑基于SATA硬盘的阵列。如果I/O负载较重的FTP、VOD、EMAIL、Web、数据库应用，那么可以考虑基于SAS/FC硬盘的存储系统。 
SSD磁盘
      solid state disk（固态硬盘），即用固态电子存储芯片阵列制成的硬盘，由控制单元和存储单元（DRAM或FLASH芯片）两部分组成。存储单元负责存储数据，控制单元负责读取、写入数据。拥有速度快，耐用防震，无噪音，重量轻等优点。
SSD是摒弃传统磁介质，采用电子存储介质进行数据存储和读取的一种技术，突破了传统机械硬盘的性能瓶颈，拥有极高的存储性能.
SSD的优势
　　SSD是摒弃传统磁介质，采用电子存储介质进行数据存储和读取的一种技术，突破了传统机械硬盘的性能瓶颈，拥有极高的存储性能，被认为是存储技术发展的未来新星。 
　　固态硬盘的全集成电路化、无任何机械运动部件的革命性设计，从根本上解决了在移动办公环境下，对于数据读写稳定性的需求。全集成电路化设计可以让固态硬盘做成任何形状。与传统硬盘相比，SSD固态电子盘具有以下优点： 
　　第一，SSD不需要机械结构，完全的半导体化，不存在数据查找时间、延迟时间和磁盘寻道时间，数据存取速度快，读取数据的能力在230M/s以上，最高的可达500M/s以上。 
　　第二，SSD全部采用闪存芯片，经久耐用，防震抗摔，即使发生与硬物碰撞，数据丢失的可能性也能够降到最小。 
　　第三，得益于无机械部件及FLASH闪存芯片，SSD没有任何噪音，功耗低。 
　　第四，质量轻，比常规1.8英寸硬盘重量轻20-30克，使得便携设备搭载多块SSD成为可能。同时因其完全半导体化，无结构限制，可根据实际情况设计成各种不同接口、形状的特殊电子硬盘。
SSD的劣势
　　固态硬盘成本高　目前的固态硬盘的每GB价格与传统硬盘相比依然有一定的差距，随着固态硬盘不断的发展，固态硬盘在2012年内每GB将低于1美元。固态硬盘将于2013到2016年内普及。 
　　固态硬盘的寿命有限 对于采用Nand Flash作为存储介质的SSD来说，怀疑其使用寿命也不是没有道理的，理论上MLC的写入寿命为1万次，SLC的写入寿命为10万次。但是否意味着一个 固态硬盘的寿命只有2到3年呢，这个也不一定。英特尔表示保证能在未来5年里，每天可以向其MLC SSD产品中写入100GB的数据，并且保证其数据的完整性。如果不是写入太频繁的话，正常使用用5年以上是没有问题的。
