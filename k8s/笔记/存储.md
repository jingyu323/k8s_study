# 存储相关

## 存储方案

DAS（直连存储）
　　是一种存储设备与服务器直接相连的架构。DAS为服务器提供块级的存储服务（不是文件系统级）。
DAS分为内部DAS和外部DAS两类：
内部DAS：
　　在内部DAS架构中，存储设备通过服务器机箱内部的并行或串行总线连接到服务器上。但是，物理的总线有距离限制，只能支持短距离的高速数据传输。此外，很多内部总线能连接的设备数目也有限，并且将存储设备放在服务器机箱内部，也会占用大量的空间 ，对服务器其它部件的维护造成困难。
外部DAS：
　　在外部DAS结构中，服务器与外部的存储设备直接相连。在大多数情况下，他们之间通过FC协议或者SCSI协议进行通信。与内部DAS相比，外部DAS克服了内部DAS对连接设备的距离和数量的限制。另外，外部DAS还可以提供存储设备集中化管理，更加方便。
NAS（网络附加存储）
　　是连接到一个局域网的基于IP的文件共享设备。NAS通过文件级的数据访问和共享提供存储资源，使客户能够以最小的存储管理开销快速直接共享文件；采用NAS可以不用建立多个文件服务器，是首选的文件共享存储解决方案； NAS还有助于消除用户访问通用服务器时的瓶颈；NAS使用网络和文件共享协议进行归档和存储，这些协议包括进行数据传输的TCP/IP和提供远程文件服务的CIFS（通用网络文件系统）、NFS（网络文件系统）。注意：采用NAS共享的时候，UNIX通常使用用NFS，Windows使用CIFS。
拓展：
　　随着网络技术的发展，NAS扩展到用于满足企业访问数据高性能和高可靠性的需求。 NAS设备是专用的、高性能的、高速的、单一用途的文件服务和存储系统。
SAN（存储区域网络）
　　是一个用在服务器和存储资源之间的、专用的、高性能的网络体系。它为了实现大量原始数据的传输而进行了专门的优化。因此，可以把FC SAN看成是对SCSI协议在长距离应用上的扩展（原先的SCSI协议最大的传输距离是6米）。FC SAN使用的典型协议组是SCSI和Fiber Channel 。 Fiber Channel特别适合这项应用，原因在于一方面它可以传输大块数据，另一方面它能够实现远距离传输。
实现IP SAN的典型协议是iSCSI，它定义了SCSI指令集在IP网络中传输的封装方式。
拓展：
　　SAN和NAS最大的区别就是NAS可以给计算节点提供文件系统 对于结算节点来说，拿到的直接就是可以共享的文件夹（共享目录）一样的感觉，但是SAN方案给计算节点提供的是一个裸盘，是无法直接进行使用的，需要对其进行格式化分区，部署文件系统等等操作以后才可以使用。 

FusionStorage采用的就是DHT算法，具有以下特点：
　　均衡性：数据能够尽可能分布到所有的节点中，这样可以使得所有节点负载均衡。
　　单调性：当有新节点加入系统中，系统会重新做数据分配，数据迁移仅涉及新增节点，现有节点上的数据不需要做很大调整。
ETL
　　是英文Extract-Transform-Load的缩写，用来描述将数据从来源端经过抽取（extract）、转换（transform）、加载（load）至目的端的过程。

## 结构化数据与非结构化数据

　　结构化数据也称作行数据，是由二维表结构来逻辑表达和实现的数据，严格地遵循数据格式与长度规范，主要通过关系型数据库进行存储和管理。
　　与结构化数据相对的是不适于由数据库二维表来表现的非结构化数据，包括所有格式的办公文档、XML、HTML、各类报表、图片和音频、视频信息等。支持非结构化数据的数据库采用多值字段、了字段和变长字段机制进行数据项的创建和管理，广泛应用于全文检索和各种多媒体信息处理领域。
半结构化数据　
　　比如存储员工的简历。不像员工基本信息那样一致每个员工的简历大不相同。有的员工的简历很简单，比如只包括教育情况；有的员工的简历却很复杂，比如包括工作情况、婚姻情况、出入境情况、户口迁移情况、党籍情况、技术技能等等。还有可能有一些我们没有预料的信息。
　　半结构化数据中结构模式附着或相融与数据本身，数据自身就描述了其相应结构模式。具体来说，半结构化数据具有下述特征：
（1）数据结构自描述性。结构与数据相交融，在研究和应用中不需要区分“元数据”和“一般数据”（两者合二为一）。
（2）数据结构描述的复杂性。结构难以纳入现有的各种描述框架，实际应用中不易进行清晰的理解与把握。
（3）数据结构描述的动态性。数据变化通常会导致结构模式变化，整体上具有动态得结构模式。



## 数据与信息

​        数据和信息是相互联系的，数据是反映客观事务属性的记录，是信息的具体表现形式。而数据经过处理和加工以后就变成信息，而信息是需要经过数字化处理转变成数据记才能进行存储和传输。
信息论观点：
​        数据=信息+数据冗余
简而言之：
​        信息就是数据中包含的有用的东西。
​        从数据中经过用户指定的规则或者特定需求场景下提炼出来的信息能够为企业带来以下好处：

​		市场以及客户行为的信息
​		更高效的运营业务
​		帮助确定风险因素 

## RAID 

### 基本原理

RAID （ Redundant Array of Independent Disks ）即独立磁盘冗余阵列，通常简称为磁盘阵列。简单地说， RAID 是由多个独立的高性能磁盘驱动器组成的磁盘子系统，从而提供比单个磁盘更高的存储性能和数据冗余的技术。 RAID 是一类多磁盘管理技术，其向主机环境提供了成本适中、数据可靠性高的高性能存储。 SNIA 对 RAID 的定义是 [2] ：一种磁盘阵列，部分物理存储空间用来记录保存在剩余空间上的用户数据的冗余信息。当其中某一个磁盘或访问路径发生故障时，冗余信息可用来重建用户数据。磁盘条带化虽然与 RAID 定义不符，通常还是称为 RAID （即 RAID0 ）。

RAID 的初衷是为大型服务器提供高端的存储功能和冗余的数据安全。在整个系统中， RAID 被看作是由两个或更多磁盘组成的存储空间，通过并发地在多个磁盘上读写数据来提高存储系统的 I/O 性能。大多数 RAID 等级具有完备的数据校验、纠正措施，从而提高系统的容错性，甚至镜像方式，大大增强系统的可靠性， Redundant 也由此而来



RAID

https://cloud.tencent.com/developer/article/2046751



RDMA

https://zhuanlan.zhihu.com/p/506835089





# CIFS和NFS的区别

（1）CIFS面向网络连接的共享协议，对网络传输的可靠性要求高，常使用TCP/IP；NFS是独立于传输的，可使用TCP或UDP；

（2）NFS缺点之一，是要求client必须安装专用软件；而CIFS集成在OS 内部，无需额外添加软件；

（3）NFS属无状态协议，而CIFS属有状态协议；NFS受故障影响小，可以自恢复交互过程，CIFS不行；从传输效率上看，CIFS优于NFS，没用太多冗余信息传送；

（4）两协议都需要文件格式转换，NFS保留了unix的文件格式特性，如所有人、组等等；CIFS则完全按照win的风格来作。





# 存储系统架构演变

https://sunjian.blog.csdn.net/article/details/125111808



# SmartThin

https://blog.csdn.net/sj349781478/article/details/125116173



## RTO和RPO



# 完全备份、增量备份和差异备份的区别在哪里？

![](images\backup.png)\



# 热备、冷备、双活

**两地 = 本地 + 异地**

**三中心 = 本地中心 + 本地容灾中心 +异地备份中心**

主备数据中心之间一般有热备、冷备、双活三种备份方式。

**热备**的情况下，只有主数据中心承担用户的业务，在**不停机情况下**对主数据中心进行备份。

**冷备**的情况下，也是只有主数据中心承担业务，在**停机情况下**对主数据中心进行备份。

**双活**是觉得备用数据中心只做备份太浪费了，所以让主备两个数据中心都同时承担用户的业务，此时，主备两个数据中心互为备份，并且进行实时备份。一般来说，主数据中心的负载可能会多一些，比如分担60~70%的业务，备数据中心只分担40%~30%的业务 。



# [共享存储、C/S和B/S架构、存储的分类和区别（SAN、NAS、DAS）、存储共享的过程](https://www.cnblogs.com/yunjisuanchengzhanglu/p/16040054.html)



DAS（Direct Attached Storage—直接连接存储），是指将存储设备通过SCSI接口或[光纤通道](http://baike.baidu.com/view/15247.htm)直接连接到服务器上

https://www.cnblogs.com/yunjisuanchengzhanglu/p/16040054.html
=======
## 容灾和备份的区别
  - 容灾的对象一般是大批量的数据，例如主用数据中心中的所有的生产数据，核心业务数据等，需要在主用数据中心或者主用业务链路出现故障时进行大范围大批量的数据迁移，以保证业务数据的不丢失和整体业务的连续性
  - 备份相对于容灾来说需要备份的数据是比较小规模的，具有明确的针对性的数据，比如针对某一个可靠性要求较高的业务数据或者某一个租户的数据等。
## 存储方案


## 磁盘数据写入方式：

-  buffer io
   -  使用Buffer I/O的时候才在内存与磁盘中间加了一层page cache。
   数据在写入的时候，数据会被先写入page cache。如果用户采用的时同步写(synchronous write)，则数据会立即从page cache写回到磁盘中；如果使用的时延迟写(deferred writes)，那么应用程序就完全不需要等到数据全部被写回到磁盘，数据只要被写到页缓存中就可以了，操作系统会定期将页缓存中的数据刷回到磁盘。而标准IO库中的一组带缓存的io函数（fopen，fread，fwrite等函数），每次调用则不直接调用内核函数，而是在用户态中创建缓存，等到一定量时才和内核交互，其中调用fflush则可以将用户态的数据刷到内核态的内存页中。
   - 优缺点
     - 优点：减少了磁盘的交互次数，由内核控制读取写入时机。
     缺点：数据需要在用户态和内核态进行多次交互，增加了内核开销；其次若机器突然宕机，则数据可能会丢失
-  mmap
   -  MMap(Memort-map) IO 能将一个磁盘文件映射到存储空间中（用户态）的一个缓存区上，于是，当从缓存区中读取数据时，就相当于读文件中的相应字节。于此类似，将数据存入缓存区时，相应字节就自动写入文件。这样就可以不使用read和write的情况下执行I/O，因此减少了内核态到用户态，用户态到内核态的多次转换。可以调用msync将mmap的page cache刷入磁盘中
   -  优缺点
   优点： 减少了内核态到用户态交互的开销，减少了磁盘的交互次数。
   缺点：机器宕机，还没写写入磁盘的数据会丢失。
-  direct io
   -  Linux允许应用程序在执行磁盘IO时绕过缓冲区高速缓存，从用户空间直接将数据传递到文件或磁盘设备，称为直接IO（direct IO）或者裸IO（raw IO）
   -  优点：如果要传输的数据量很大，降低数据在page cache中的拷贝带来的开销，提高性能。
   缺点：Direct I/O的开销大，因为没有page cache的使用，因此内核中很多对page cache的优化也无法使用（例如：按顺序预读取，在成簇磁盘块上执行IO，允许访问同一文件的多个进程共享高速缓存的缓冲区等）



## HyperReplication  远程复制

https://blog.csdn.net/m0_49864110/article/details/124126379











## RAID


## 硬盘类型：
### SSD
### SAS
### NL-SAS

## RAID2.0+





**TOE网卡和iSCSI HBA卡有什么区别**

TOE网卡是指带有TOE功能的网卡。TOE是TCP/IP Offload Engine的缩写，它是网卡采用的一种新技术，采用TOE技术的网卡自身支持TCP/IP协议栈的处理，这样能够减轻应用服务器的处理负担。TOE网卡通常用于高速网络接口，如千兆和万兆网络。

iSCSI HBA（Host Bus Adapter）卡是专用的连接iSCSI设备的主机适配卡，它支持TOE的同时还支持对iSCSI协议的处理，能够更进一步的减轻应用服务器的处理负担



# 存储基础：LUN、ThickLUN与Thin LUN的联系和区别

原文链接：https://blog.csdn.net/M_joy666/article/details/80566705

一、基本概念

       LUN：全称是Logical Unit Number，中文名是逻辑单元号。LUN是在存储设备上可以被应用服务器识别的独立存储单元。一个LUN的空间来源于存储池Pool，Pool的空间来源于组成磁盘阵列的若干块硬盘。从应用服务器的角度来看，一个LUN可以被视为一块可以使用的硬盘。例如，在Linux系统中，它在/dev/rdsk、/dev/dsk目录下有相应的设备名称；在Windows系统中，格式化后的新LUN会对应一个类似于D E F的盘符。
    
      Thick LUN：中文名是传统非精简LUN，是LUN类型的一种，支持虚拟资源分配，能以较为简便的方式进行创建、扩容和压缩操作。Thick LUN在创建完成后就会从存储池Pool中分配满额的存储空间，即LUN的大小完全等于分配的空间。因此，它拥有较高的可预测性。
    
      Thin LUN：中文名是精简LUN，也是LUN类型的一种，支持虚拟资源分配，能够以较简便的方式进行创建、扩容和压缩操作。Thin LUN在创建的时候，可以设置一个初始分配容量。创建完成后，存储池Pool只会分配这个初始容量大小的空间剩余的空间仍然放在存储池中。当Thin LUN已分配的存储空间的使用率达到阈值时，存储系统才会再从Pool中划分一定的配额给Thin LUN。如此反复，直到达到Thin LUN最初设定的全部容量。因此，它拥有较高的存储空间利用率。

二、Thick LUN与Thin LUN的区别

 1、空间分配上的区别

Thick LUN在创建时会分配所有需要的空间
Thin LUN是一种按需分配的空间组织方法，它在创建时存储池不会分配所有需要的空间，而是根据使用情况动态分配。
    二者的空间分配区别如下图所示：



 2、空间回收的区别

  注：这里的空间回收指的是释放存储池Pool中的资源，并且这些资源可以被其他LUN使用。

Thick LUN没有空间回收的概念，因为它在创建时就占用存储池中所有分配给它的空间，即使Thick LUN中的数据被删除，存储池中分配给它的空间还是被占用，不能被其他的LUN使用。但是如果手动删除不再使用的Thick LUN，则对应的空间会被回收。
Thin LUN不仅能够做到空间占用率增大时自动分配新的存储空间，而且当Thin LUN中的文件删除时也可以实现空间的释放，从而实现存储空间的反复利用，大大提高存储空间的利用率。Thin LUN的空间回收如下图所示：

 3、性能的区别

Thick LUN由于在一开始就会拥有所分配的空间，所以Thick LUN在顺序读写的时候拥有较高的性能，但是会造成空间资源的浪费。
Thin LUN由于是实时分配空间，每次扩容时，需要重新增加容量，后台重新格式化，这个时候性能会受到一定影响，而且每次分配空间可能会导致硬盘中存储空间不连续，这样硬盘读写数据时在寻找存放位置上花费的时间会较多，会在顺序读写时对性能有一定影响。
 4、使用场景的区别

Thick LUN：①对性能要求较高的场景；②对存储空间利用率不太敏感的场景；③对成本要求不太高的场景。
Thin LUN：①对性能要求一般的场景；②对存储空间利用率比较敏感的场景；③对成本比较敏感的场景；④应用环境很难预 估存储空间的场景
三、总结

      总而言之，Thick LUN和Thin LUN各有特点。Thick LUN的性能较高，但是会造成空间资源的浪费；Thin LUN可以灵活配置使用存储池中的空间，但是会导致分配的存储空间不连续，所以性能不高。具体使用哪一种还需视情况而定。




| HyperSnap        | 就是快照，有COW和ROW；                                       |
| ---------------- | ------------------------------------------------------------ |
| HyperClone       | 分主LUN，从LUN；从生产数据中快速复制出副本，并独立共享给应用服务器读写，用于测试、分析或者容灾演练等应用，同时不影响生产数据。 主要的点，在于 目标LUN是立刻可读写的，不需要等待后台拷贝完成； 当源LUN损坏之后，目标LUN可以反向同步数据到源LUN完成数据恢复； |
| HyperCopy        | LUN拷贝会将所有数据进行完整地复制，需要暂停该LUN的业务。     |
| HyperMirror      | ● 对一个LUN提供两个镜像物理副本，这两个副本中的数据是完全一样的。当其中的一个镜像副本出现故障时，LUN上的业务不受任何影响，主机侧仍然可以毫无感知的正常工作。● 这个被持续保护的LUN可以是OceanStor系列存储系统（以下简称为本端存储系统）的LUN，也可以是第三方存储系统（以下简称异构存储系统）的LUN。 |
| HyperReplication | 指的是远程复制，主要是为了异地冗余；远程复制支持以下两种复制模式：● 同步远程复制实时地同步数据，最大限度保证数据的一致性，以减少灾难发生时的数据丢失量。● 异步远程复制周期性地同步数据，最大限度减少由于数据远程传输的时延而造成的业务性能下降。 是用于主备容灾，通过将源LUN与目标LUN建立pair关系，来进行数据同步； |

# SCSI、FC、iSCSI三大协议详解及比较

**一、SCSI**



SCSI是小型计算机系统接口（Small Computer System Interface）的简称，于1979首次提出，是为小型机研制的一种接口技术，现在已完全普及到了小型机，高低端服务器以及普通PC上。

SCSI可以划分为SCSI-1、SCSI-2、SCSI-3，最新的为SCSI-3，也是目前应用最广泛的SCSI版本。 

1、SCSI-1：1979年提出，支持同步和异步SCSI外围设备；支持7台8位的外围设备，最大数据传输速度为5MB/s。 
2、SCSI-2：1992年提出，也称为Fast SCSI，数据传输率提高到20MB/s。 
3、SCSI-3：1995年提出，Ultra SCSI（Fast-20）。Ultra 2 SCSI（Fast-40）出现于1997年，最高传输速率可达80MB/s。1998年9月，Ultra 3 SCSI（Utra 160 SCSI）正式发布，最高数据传输率为160MB/s。Ultra 320 SCSI的最高数据传输率已经达到了320MB/s。

二、FC（光纤通道）

FC光纤通道：用于计算机设备之间数据传输，传输率达到2G（将来会达到4G）。光纤通道用于服务器共享存储设备的连接，存储控制器和驱动器之间的内部连接。

协议基本架构： 
FC-4 Upper Layer Protocol:SCSI,HIPPI,SBCCS,802.2,ATM,VI,IP 
FC-3 common service 
FC-2 Framing Protocol /Flow Control 
FC-1 Encode/Decode 
FC-0 Media:Optical or copper,100MB/sec to 1.062GB/sec

协议层说明： 
FC-0：物理层，定制了不同介质，传输距离，信号机制标准，也定义了光纤和铜线接口 
以及电缆指标 
FC-1：定义编码和解码的标准 
FC-2：定义了帧、流控制、和服务质量等 
FC-3：定义了常用服务，如数据加密和压缩 
FC-4：协议映射层，定义了光纤通道和上层应用之间的接口，上层应用比如：串行SCSI 协 议，HBA 的驱动提供了FC-4 的接口函数，FC-4 支持多协议，如：FCP-SCSI,　FC-IP,FC-VI

协议简介： 
FCP-SCSI：是将SCSI并行接口转化为串行接口方式的协议，应用于存储系统和服务器之间的数据传输。新的ANSI T10 标准，支持SAN 上存储系统之间通过数据迁移应用来直接移动数据。 FCP-SCSI 提供200MB/s（全双工独占带宽）的传输速率，每连接最远达10 公里，最大16000000 个节点。FCP-SCSI 使用帧传输取代块传输。帧传输以大数据流传输方式传输短的小的事务数据。

三、iSCSI



iSCSI（互联网小型计算机系统接口）是一种在TCP/IP上进行数据块传输的标准。它是由Cisco和IBM两家发起的，并且得到了各大存储厂商的大力支持。iSCSI可以实现在IP网络上运行SCSI协议，使其能够在诸如高速千兆以太网上进行快速的数据存取备份操作。

iSCSI标准在2003年2月11日由IETF（互联网工程任务组）认证通过。iSCSI继承了两大最传统技术：SCSI和TCP/IP协议。这为iSCSI的发展奠定了坚实的基础。基于iSCSI的存储系统只需要不多的投资便可实现SAN存储功能，甚至直接利用现有的TCP/IP网络。相对于以往的网络存储技术，它解决了开放性、容量、传输速度、兼容性、安全性等问题，其优越的性能使其备受始关注与青睐。

工作流程： 
iSCSI系统由SCSI适配器发送一个SCSI命令。 
命令封装到TCP/IP包中并送入到以太网络。 
接收方从TCP/IP包中抽取SCSI命令并执行相关操作。 
把返回的SCSI命令和数据封装到TCP/IP包中，将它们发回到发送方。 
系统提取出数据或命令，并把它们传回SCSI子系统。

安全性描述： 
iSCSI协议本身提供了QoS及安全特性。 
可以限制initiator仅向target列表中的目标发登录请求，再由target确认并返回响应，之后才允许通信。 
通过IPSec将数据包加密之后传输，包括数据完整性、确定性及机密性检测等。

iSCSI的优势： 
（1）广泛分布的以太网为iSCSI的部署提供了基础。 
（2）千兆/万兆以太网的普及为iSCSI提供了更大的运行带宽。 
（3）以太网知识的普及为基于iSCSI技术的存储技术提供了大量的管理人才。 
（4）由于基于TCP/IP网络，完全解决数据远程复制（Data Replication）及灾难恢复（Disaster Recover）等传输距离上的难题。 
（5）得益于以太网设备的价格优势和TCP/IP网络的开放性和便利的管理性，设备扩充和应用调整的成本付出小。



四、iSCSI和FC的比较

从传输层看，光纤通道的传输采用其FC协议，iSCSI采用TCP/IP协议。

FC协议与现有的以太网是完全异构的，两者不能相互接驳。因此光纤通道是具有封闭性的，而且不仅与现有的企业内部网络（以太网）接入，也与其他不同厂商的光纤通道网络接入（由于厂家对FC标准的理解的异样，FC设备的兼容性是一个巨大的难题）。因此，对于以后存储网络的扩展由于兼容性的问题而成为了难题。而且，FC协议由于其协议特性，网络建完后，加入新的存储子网时，必须要重新配置整个网络，这也是FC网络扩展的障碍。

iSCSI基于的TCP/IP协议，它本身就运行于以太网之上，因此可以和现有的企业内部以太网无缝结合。TCP/IP网络设备之间的兼容性已经无需讨论，迅猛发展的internent网上运行着全球无数家网络设备厂商提供的网络设备，这是一个最好的佐证。 

**![img](https://img-blog.csdn.net/2018052414444993)**



从网络管理的角度看，运行FC协议的光网络，其技术难度相当之大。其管理采用了专有的软件，因此需要专门的管理人员，且其培训费用高昂。TCP/IP网络的知识通过这些年的普及，已有大量的网络管理人才，并且，由于支持TCP/IP的设备对协议的支持一致性好，即使是不同厂家的设备，其网络管理方法也是基本一致的。

FC运行于光网络之上，其速度是非常快的，现在已经达到了2G的带宽，这也是它的主要优势所在。下一代的FC标准正在制定当中，其速度可以达到4G，今天的千兆以太网已经在普及当中，这也是基于TCP/IP的iSCSI协议进入实用的保证。

得益于优秀的设计，以太网从诞生到现在，遍及了所有有网络的地方，到现在依然表现出非凡的生命力，在全球无数网络厂商的共同努力下，以太网的速度稳步提升，千兆网络已经实际应用，万兆网络呼之欲出，以太网的主要部件交换机路由器均已有万兆级别的产品。随着产品的不断丰富，以及设备厂商间的剧烈竞争，其建设成本在不断下降，万兆网络的普及已日益临近

#### **重构与预拷贝的区别？**

> 重构：直接使用其它盘的冗余数据通过RAID算法来重构失效盘的数据；
> 预拷贝：优先利用其它盘的冗余数据来重构失效盘的数据，在无法利用其它盘的数据来重构时，会重新尝试直接从慢盘或预失效盘本身来读取数据做拷贝。

 

#### **重构任务有哪些类型？**

> 重构任务类型有：全盘重构、预拷贝、恢复重构、局部重构；
> 全盘重构：硬盘故障或者被拔走触发的重构，对全盘数据做重构；
> 预拷贝：硬盘上报慢盘或者预失效后起的重构，先进行全盘重构，全盘重构不了再拷贝本盘数据；
> 恢复重构：硬盘故障或者被拔走后再重新插回来起的重构，重构的是硬盘被拔走期间降级写数据区域；
> 局部重构：读写遇到坏块起的重构，只对CKG其中的坏块区域做重构，重构后将该坏块区域隔离掉。

# quota tree

https://support.huawei.com/enterprise/zh/doc/EDOC1100098153/6516ded9

# 【RDMA】技术详解（一）：RDMA概述

https://blog.csdn.net/bandaoyu/article/details/112859853s





# 存储资源调优——重删压缩技术

https://blog.csdn.net/m0_49864110/article/details/123974131





## 备份

###### 常用备份拓扑

存储网络主要分为前端业务网以及后端的存储网络，业务网主要受理用户的请求，后端存储网主要用户数据的读取和写入，有一些企业出于成本的考虑，不会使用后端存储网，因此会涉及到备份的组网形式。
**1.LAN-BASED**
不存在后端存储网，备份的数据流和业务的数据流就需要在一个网络中进行传输，其优点是节省开销，但备份时，备份流量会占用业务带宽，影响整体的处理性能。
**2.LAN-FREE**
如果客户前端业务网和后端的存储网都有架设，那么备份时就可以使用后端的存储网络做备份，传输备份数据流，这样做就不会影响到前端业务的正常执行。
**注：**
　　LAN指业务网络
**3.Server-Free**
一般用于虚拟机备份，通过给主机创建临时虚拟机，将需要备份的数据创建快照，把快照挂载在备份设备上，备份设备通过读取临时虚拟机内的快照，然后进行数据的转存操作
（1）CS：备份服务器，通过备份服务器来控制整体的备份进程，执行相关的备份策略，是整体的控制服务器
（2）CA：备份的数据源（Agent），需要备份哪个服务器或存储的数据就将Agent安装在那个设备上
（3）MA：备份介质，备份的数据存储在哪一台设备上就在其之上的服务器安装Agent

###### 备份策略内容

1.数据类型：文件、操作系统、数据库...
2.备份介质：磁盘阵列、磁带...
3.备份类型：全量备份（恢复时直接恢复，最快）、增量备份（每次备份和上次备份的差异部分，恢复时需要整合前几次备份的内容，耗时最长）、差量备份（每次备份和全量备份的差异部分，恢复时需要整合上一次全量+这次差量）
4.数据保留时间
5.备份周期
6.备份窗口：啥时候备份，备份多久

###### 常见备份结构

1.DAD：磁盘-磁盘的数据备份，速度快，保存时间长，且不需要服务器，但成本高
2.D2T：磁盘-物理磁带库的数据备份，保存不方便，磁盘时间长容易消磁，不过便宜
3.D2V：磁盘-虚拟磁带库的数据备份
4.D2D2T：磁盘-虚拟磁带库-物理磁带的数据备份，最安全快速方便，但也最贵

###### 备份开销计算

1.带宽开销：假如公司有8T数据，每天增长100G，备份时间为一小时，求带宽？
100G*1000/（1*60*60*有效带宽%）
2.容量开销：假如公司200G数据，每天增长20G，每周一次全量备份，数据留一个月，则最小存储容量？
　　　　　原　增　　备份
第一周：   200　120　　320
第二周：   520　120　　640
第三周：   1160　120　1280
第四周：   2440　120　2560
**注：**
　　全量备份得把这一周备份的加上原来的，所以像第一周总共就是200+320
结果：一个月最少要5T容量
**备份建议**
每天做增量备份，每周一次全量备份，每月清除一次备份数据。

###### 重复数据删除技术

基于上面全量备份可发现备份的容量开销实在太大了，所以就需要用到该技术，该技术就是为了解决数备份过程中由于数据量过大占用大量存储空间的情况。由于备份时很多数据都是重复，所以空间就会重复占用，重删技术首先会在存储介质的后台创建一个指纹数据库，该指纹数据库在未备份时是空的，开始备份后首先会将文件切分成数据块，给数据块通过哈希算法计算指纹值，然后和指纹数据库作对比，第一个数据库对比时由于指纹数据库是空的所以比对不上，也就是当前该数据块是唯一的，所以将该数据按照原有的计划写入，并且将自己的地址和指纹信息添加进指纹数据库中，后边的数据块会进行数据库比对，按照上面的方式，如果比对到了指纹数据库，那么该数据就不会再拷贝到备份介质，而是将指纹数据库中的比对到的地址添加到一个映射到该数据库的位置。

###### 重删的分类

1.全局重删
2.本地重删：针对多个重删源使用几个指纹库
3.源端重删：备份端重删
4.目标端重删：服务器做重删，华为就是用这种
5.在线重删：消耗资源
6.后处理重删：消耗存储空间
7.文件级重删
8.块级重删

###### 重删关键指标

1.重删率：能节省多少空间
2.重删性能：多久能删完
3.数据可靠性：是否数据可靠，是否可随时恢复
4.复制性能：容灾场景下需要多久才DR-Ready
5.恢复性能：一旦数据丢失需要多久找回

###### 压缩

靠压缩算法实现（重删靠切块比对，实现保留唯一数据）
1.空格压缩：将多个空格压缩成一个代码
2.游长压缩：比如AAAAAAAAAA就变成A.&10
3.定长压缩：比如AAAAAAAAAA就变成A5.A5
4.关键字压缩：自定义关键字压缩为特定字符
5.哈夫曼压缩法
**注：**
　　重删的删减率比压缩大，重删会破坏数据，而压缩不会，所以建议先做重删再做压缩，从而保证数据量缩减时可以达到最大化。

### 容灾

###### 容灾分类

1.业务级容灾
2.应用级容灾
3.数据级容灾

###### 容灾系统衡量指标/核心参数

**1.RPO恢复点目标**
灾难发生后，系统和数据必须恢复到的时间点要求，也就是说数据丢失的时间量，比如8点备份，9点故障恢复到8点的样子，那么RPO=1h。
**2.RTO恢复时间目标**
灾难发生后，信息系统或业务功能从停顿到必须恢复的时间要求，也就是说故障的恢复时间，比如9点业务故障，9点半恢复，则RTO=30min。
**注：**
　　确保容灾业务的高可靠性和可用性，一般要求RPO<=10S，RTO<=3min。

###### 容灾系统建设国际标准

1级：Tier1-PTAM，将数据进行拷贝然后运输到异地做冷备（数据），RPO：一周，RTO：一周
2级：Tier2-PTAM加热备站点，将数据拷贝然后在热备站点进行留存（数据），RPO：几天，RTO：几天
3级：电子链接传输，通过网络进行数据传输和数据备份（数据），RPO：2-4天，RTO：12h左右
4级：批量/在线数据库镜像或日志传输（应用），RPO：几小时，RTO：4-8h
5级：两地间两阶段提交（交易完整性），通过远程复制等形式进行数据的备份（应用），RPO：1-3h，RTO：1-4h
6级：几乎0数据丢失，远程数据竞选保证数据完整性和一致性，通过两地站点进行业务的数据保障（业务），RPO：>=0，RTO：>=0
7级：华为自己出的，在6级基础上多了自动化系统接管，无人值守自动切换，RPO：>=0，RTO：>=0

###### 容灾测试

搭建一个虚拟环境来测试当故障出现后能不能正常使用。

###### 容灾演练

模拟出现故障的情况进行实际的业务切换以及故障处置操作。

###### 故障切换

发生真实故障之后，执行业务的切换和拉起。

###### 典型容灾解决方案

两地三中心：3个站点——主站点、同城灾备站点、远程灾备站点。

## SAS协议

https://blog.csdn.net/sinat_37817094/article/details/120935299



## SmartTier

 https://blog.csdn.net/sj349781478/article/details/125116313

# 存储数据保护技术——远程复制
