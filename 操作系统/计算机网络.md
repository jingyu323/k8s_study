# 计算机网络
主要分析计算机硬件的逻辑实现，基本操作原理



## 计算机网络组成部分：

硬件、软件、协议

带宽：发送端发送数据的速率



协议：为进行网络中的对等实体数据交换而建立的规则、标准或者约定。



表示层：数据格式转换、数据加密解密、数据压缩和恢复

会话层： 表示实体和用户建立连接并在连接上有序的传输数据。
传输层：端到端的通信

​	功能

1. ​	可靠传输、不可靠传输
2. 差错控制
3. 流量控制
4. 服用分用

   在RSTP标准中，为了提高收敛速度，将交换机直接与终端相连的端口定义为边缘端口
=======

在RSTP标准中，为了提高收敛速度，将交换机直接与终端相连的端口定义为边缘端口

STP生成树的生成过程大概如下：

1、选举根桥（Root Bridge）

2、选举根端口（Root Port）

3、选举指定端口（Designated Port）

4、阻塞备用端口（Blocking Port）



# RSTP端口状态



生成树端口状态

1、阻塞（disarding）

2、侦听（listening）

3、学习（learning）

4、转发（forwarding）

5、禁用（disabled）



OSPF（Open Shortest Path First）协议共有5种分组类型，包括：

Hello 分组：用于发现邻居、建立邻居关系和检测邻居状态的分组。

DBD（Database Description）分组：用于在邻居之间传输每个路由器的链路状态数据库摘要信息，以确定是否存在差异。

LS Request（Link State Request）分组：用于请求某个邻居发送某些路由器的链路状态信息。

LS Update（Link State Update）分组：包含某个路由器更新后的链路状态信息，并通过网络广播给所有邻居。

LS Acknowledge（Link State Acknowledge）分组：用于确认接收到LS Update分组并向发送方报告接收情况。

DIS和DR与所路由器互相都是邻接关系





# BGP

BGP是一种另外的网关协议，可以做到路由优选、避免路由环路、更高效率传递路由和维护大量的路由信息。

https://blog.csdn.net/u012451051/article/details/125397172



AS之间正常存在大量的BGP邻居关系，且BGP协议不会计算最佳路径；因此在BGP协议中管理员需要进行策略来干涉选路;



BGP对等体：两个建立BGP会话（BGP的会话是基于TCP建立的）的路由器互为BGP对等体，BGP对等体之间可以交换路由表；



BGP对等体分类：BGP对等体可以按照两个路由器是否AS相同，分为EBGP对等体和IBGP对等体



### HDLC 

### TCP IP 协议
不支持多播，只能解决两个进程之间的通信问题
- 长度小于64K字节
- IP编组方案
- 分组封装格式
- 分组转发规则

网络层：

​	主要任务是把分组从源端传到目的端，为分组交换网上的不同主机提供通信服务。网络层传输单位是 数据包。



- 路由选择
- 流量控制
- 差错控制
- 拥塞控制

### PPP 协议

PPP点到点协议工作于OSI参考模型的二层（数据链路层）

2.这种链路提供全双工操作，并按照顺序传递数据包。

3.设计目的主要是用来通过拨号或专线方式建立点对点连接发送数据，使其成为各种主机、网桥和路由器之间简单连接的一种共通的解决方案。

**4.PPP链路的建立：**
LCP即链路控制协议，用于建立和维护点到点链路
NCP即网络控制协议，用于建立和配置网络层协议

### OSPF 协议

在OSPFv2中，收到类型未知的LSA将直接丢弃。

OSPFv3在LSA的LS Type字段中增加了一个U比特位来位标识对未知类型LSA的处理方式：     

  U 比特置 1，则对于未知类型的 LSA 按照 LSA 中的 LS Type 字段描述的泛洪范围进行泛洪                                              U 比特置 0，对于未知类型的 LSA 仅在链路范围内泛洪   

LSA的泛洪范围已经被明确地定义在LSA的LS Type字段，目前，有三种LSA泛洪范围：

 链路本地范围(Link-local Scope)：LSA 只在本地链路上泛洪，不会超出这个范围， Link-LSA(新增)                                              区域范围(Area Scope)：Router-LSA, Network-LSA, Inter-Area-Prefix-LSA, Inter-Area-Router-LSA, Intra-Area-Prefix-LSA(新增)都是区域范围泛洪的 LSA。                                              自治系统范围(AS Scope)：LSA 将被泛洪到整个路由域，AS-External-LSA

### 组播协议：

PIM（Protocol Independent Multicast）协议是一种IP组播协议，它可以在不同的网络层协议上实现组播功能。PIM协议的主要作用是构建组播树，以便将组播数据从源主机传递到所有需要接收数据的主机。

PIM协议有两种模式：PIM Sparse Mode（PIM-SM）和PIM Dense Mode（PIM-DM）。PIM-SM是一种基于源的协议，它会动态地构建组播树来传递组播数据。PIM-DM是一种基于接收者的协议，它会将组播数据在整个网络中广播，直到所有需要接收数据的主机都接收到了数据为止。
 在PIM-SM模式下，PIM协议使用的是一种叫做“贪婪算法”的机制。当一个主机需要接收组播数据时，它会向网络中发送一个加入请求，然后PIM协议会自动选择一个最优路径来传递组播数据。PIM协议会构建一棵组播树，以便将组播数据从源主机传递到所有需要接收数据的主机。

在PIM-DM模式下，PIM协议会将组播数据在整个网络中广播，直到所有需要接收数据的主机都接收到了数据为止。这种模式适用于网络中的接收者比较密集的情况。但是，由于它会将组播数据广播到整个网络中，所以会导致网络负载较大。

#### PIM-DM

#### 定义

- PIM密集模式
- 假定网络中组播接收者较多，且分部于大部分设备上，采用推的方式分发组播数据
- 适用于小规模组播网络

#### 邻居发现机制

- PIM路由器之间周期性发送Hello报文来发现、建立和维护邻居关系
- 如网段中IGMP版本是v1，则Hello报文可以选举查询器

####  PIM-SM

#### 定义

- PIM稀疏模式：适用于任何规模的网络
- 采取拉的方式，根据接收者的需求，在组播接收者和组播源之间建立组播分发树
- 无论网段中的IGMP协议是什么版本，都通过Hello报文选举查询器

#### 邻居发现机制

- 与PIM-DM相同

### 数据帧

**MTU 是指数据链路层能够传输的最大数据帧的大小（以字节为单位）**


基带信号：数字1和0直接用两种不同的电压表示，再送到数字信道上去 

宽带信号：将基带信号调制成的频分复用模拟信号

以太网数据帧最短帧长涉及到[CSMA](https://so.csdn.net/so/search?q=CSMA&spm=1001.2101.3001.7020)/CD机制

原因是当数据帧到达网卡时，在物理层上网卡要先去掉前导同步码和帧开始定界符，然后对帧进行CRC检验，如果帧校验和错，就丢弃此帧。如 果校验和正确，就判断帧的目的硬件地址是否符合自己的接收条件（目的地址是自己的物理硬件地址、广播地址、可接收的多播硬件地址等），如果符合，就将帧交 “设备驱动程序”做进一步处理。这时我们的抓包软件才能抓到数据，因此，抓包软件抓到的是去掉前导同步码、帧开始分界符、FCS之外的数据，其最大值是 6＋6＋2＋1500＝1514。

以太网规定，以太网帧数据域部分最小为46字节，也就是以太网帧最小是 6＋6＋2＋46＋4＝64。除去4个字节的FCS，因此，抓包时就是60字节。当数据字段的长度小于46字节时，MAC子层就会在数据字段的后面填充以 满足数据字段到46字节。

总结：
如果MTU是最小的46，则抓包长度是6+6+2+46=60，即最小抓包长度是60
如果MTU是最大的1500，则抓包长度是6+6+2+1500=1514，即最小抓包长度是60

路由协议是指定数据包转送数据包转送方式的网上协议。
常见协议有：RIP，IGRP，EIGRP，
无冲突协议： 令牌协议

CSMA/CD 协议

RFID：是什么？
利用电磁或者电感信好，射频识别

## 性能指标：

1.速率即数据率

主机再数字信道上传送数据位数的速率



![](images\net_rate.png)





# WLAN

1.CSS集群最多支持两台交换机
2.堆叠系统中，主交换机负责管理整个堆叠系统
3.堆叠技术可以简化网络拓扑，使网络结构变得更简单
4.iStack最多支持9台交换机做堆叠



MAC 是确定网络设备身份，

网络节点传输协议：



## 网络工具

ATKKping 可以快速检测目标主机到本机的网络状态



## Vlan

创建 vlan

```
vlam 10
#查看vlan
dis vlan 
# 配置vlan
int  g0/0/1
port link-type access

```

## 子网掩码

就是用来分割子网和区分那些ip是同一个网段的，那些不是同一网段的
子网掩码转为二进制数， 
16位子网掩码：255.255.0.0
 17位子网掩码：255.255.128.0 
 18位子网掩码：255.255.192.0 
 19位子网掩码：255.255.224.0 
 20位子网掩码：255.255.240.0 
 21位子网掩码：255.255.248.0 
 22位子网掩码：255.255.252.0 
 23位子网掩码：255.255.254.0 
 24位子网掩码：255.255.255.0 
 25位子网掩码：255.255.255.128 
 26位子网掩码：255.255.255.192 
 27位子网掩码：255.255.255.224 
 28位子网掩码：255.255.255.240 
 29位子网掩码：255.255.255.248 
 30位子网掩码：255.255.255.252 
 31位子网掩码：255.255.255.254 
 32位子网掩码：255.255.255.255  

 总结： IP 地址+子网掩码 确定一个网址是否在同一个网段，
 子网掩码作用：确定网络位，网络位之后就能确定确定IP是否在同一个网段。

 通信方式：

- 同网段：直接发送数据包
- 不同网段：  找中间设备，路由器转发

A类：1-126 子网掩码 255.0.0.0
B类：128-191 默认子网掩码 255.255.0.0
C类：192-223 默认子网掩码 255.255.255.0
D类：224-239  224.0.0.1～239.255.255.254   支持多播
E类：224-239 240.0.0.1～255.255.255.254

判断一个地址能不能用：主机位不能全为0或者全为255

子网号

IP地址子网掩码判断：

202.101.35.45/27 根据/27 可知道网络位为27位 即主机位为32-27=5位
子网数为 2^3=8个
每个子网中的主机数有2^5=32个主机 去掉全0和全1 剩余30个主机
由此可知 子网中的主机块范围是
0-31（本地网络去除）
31-63
64-95
96-127
128-159
160-191
192-223
224-255 （子网广播去除）
除去网络位中和主机位中全0和全1的地址，实际可以应用的地址是：
子网1 33～62
子网2 65～94
子网3 97～126
子网4 129～158
子网5 161～190
子网6 193～222
由此可判断同此ip同一子网的应该是
202.101.35.60/27





### 域名
定级域名 296


### 网关


ping  -t  目标IP  一直ping
ping -n  数字 目标IP   指定ping几个包
ping -l  数字 目标IP   修改ping包大小


nslookup www.jd.com

###  二层交换机和三层交换机

二层交换机：数据转发 ，只能支持同网段的访问，不支持不同网段访问
三层交换机：数据交换+ 路由功能，支持不同网段访问
三层交换机配置不同网段，

通过vlan ip做网关，实现不同vlan的路由，也就是说不同网段的vlanIP 需要配置成网关IP才能支持不同网段互相访问

vlanif是一个三层逻辑端口，在二层网络中作为网关存在。
vlan是二层概念，vlan互通需要三层通信，vlanif应被配置在这个三层网元上。
二层交换机和三层交换机相连的端口属性要设置为Trunk且运行所有vlan通过；

一、Access
Access只能属于一个vlan，一般用来连接计算机的端口
Access接受和转发的数据包必是无VID的数据包
Access端口发送出去的数据包无VID，可被PC接受或access口接受。
Access : 收到一个报文，先判断是否有vlan消息，无则打上端口的PVID在SW内转交给相同PVID的端口去掉标记的无VID数据包，有则直接丢弃。
二、Trunk
Trunk：可以允许多个vlan通过，可以接收和发送多个vlan的报文，一般用于交换机之间连接端口
Trunk：默认PVID与vlan1相等
在默认状态下，Trunk端口允许所有的Vlan发送和接口传输信息。
Trunk：收到一个报文，先判断是否有vlan消息，无则打上端口的PVID在SW内转交给其它端口;有则先判断trunk端口是否允许该vlan的数据进入，如果可以则转发，否则丢弃。
Trunk：在发送时，比较要发送报文的VID与端口的PVID，不相等则直接发送；相等则剥离VID，再发送
三、区别：
Access口只接收无VID的数据包。
access口发送数据包时对所有数据包去除VID，而trunk口只对与自己端口的PVID相等的数据包去除VID，其它则直接转发。

PVID英文为Port-base VLAN ID，是表示网络通信中基于端口的VLAN ID，一个端口可以属于多个VLAN，但是只能有一个PVID，收到一个不带tag头的数据包时，会打上PVID所表示的VLAN号，视同该VLAN的数据包处理。



## 交换机

全双工，自动协商速率

使用命令：

```
# 查看本地arp表内容
arp -a
# 交换机查看arp mac地址表
sh mac-addres-table
```

mac 地址的老化时间300s

### 二层转发：

根据检测mac直接进行端口转发。

#### 转发方式：

1. ​	存储转发 完整收到帧 并检查无误之后转发。缺点是延迟较大且不固定，因为在转发之前要收到并处理完整的帧。

2. 碎片隔离

   

